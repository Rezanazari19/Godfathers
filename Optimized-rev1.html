<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mafia Game Moderator</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            min-height: 100vh;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(44, 62, 80, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: #e74c3c;
        }
        
        h2 {
            color: #3498db;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        h3 {
            color: #3498db;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }
        
        /* Game Statistics - Always visible */
        .game-stats-header {
            background: rgba(241, 196, 15, 0.2);
            border: 2px solid #f1c40f;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .player-list-header {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .player-item {
            background: rgba(52, 73, 94, 0.8);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(149, 165, 166, 0.2);
            font-size: 13px;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .player-item:hover {
            transform: translateY(-2px);
            background: rgba(52, 73, 94, 0.9);
        }
        
        .player-item.eliminated {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            text-decoration: line-through;
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .player-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: rotate(5deg);
        }
        
        .role-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .role-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(52, 73, 94, 0.8);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(149, 165, 166, 0.2);
        }
        
        .role-name {
            font-weight: bold;
            flex: 1;
            color: #bdc3c7;
            font-size: 13px;
        }
        
        input[type="number"] {
            width: 50px;
            padding: 6px;
            border: none;
            border-radius: 5px;
            background: rgba(236, 240, 241, 0.9);
            color: #2c3e50;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .total-players {
            text-align: center;
            font-size: 1.3em;
            margin: 15px 0;
            padding: 12px;
            background: rgba(241, 196, 15, 0.2);
            border-radius: 10px;
            border: 2px solid #f1c40f;
            color: #f1c40f;
        }
        
        button {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: #ecf0f1;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 8px 4px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            min-height: 44px; /* Touch-friendly */
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        
        .player-input {
            margin-bottom: 12px;
        }
        
        .player-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #bdc3c7;
            font-size: 13px;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(236, 240, 241, 0.9);
            color: #2c3e50;
            font-size: 14px;
            min-height: 44px; /* Touch-friendly */
        }
        
        .player-role-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(52, 73, 94, 0.8);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border: 1px solid rgba(149, 165, 166, 0.2);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .role-reveal {
            background: #27ae60;
            padding: 8px 12px;
            font-size: 13px;
            min-height: 36px;
        }
        
        .role-revealed {
            background: #e74c3c;
        }
        
        .hidden-role {
            font-style: italic;
            color: #95a5a6;
        }
        
        .elimination-section {
            margin-top: 20px;
        }
        
        .player-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        
        .player-button {
            background: #3498db;
            padding: 12px 8px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ecf0f1;
            border: none;
            font-size: 13px;
            min-height: 44px;
            text-align: center;
        }
        
        .player-button:hover {
            background: #2980b9;
        }
        
        .player-button.selected {
            background: #e74c3c;
        }
        
        .eliminated-role {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            padding: 12px;
            margin-top: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
        }
        
        .night-action-block {
            background: rgba(52, 73, 94, 0.8);
            border: 1px solid rgba(149, 165, 166, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .night-action-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 12px;
        }
        
        .player-name-display {
            color: #5dade2;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .eliminated-display {
            color: #ec7063;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .radio-group {
            margin: 10px 0;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.2s;
        }
        
        .radio-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .radio-item input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2); /* Larger for mobile */
        }
        
        .radio-item label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
        }
        
        .jailed-message {
            color: #e74c3c;
            font-weight: bold;
            text-align: center;
            padding: 8px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 5px;
            margin: 8px 0;
        }
        
        select {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(236, 240, 241, 0.9);
            color: #2c3e50;
            margin: 8px 0;
            width: 100%;
            font-size: 14px;
            min-height: 44px;
        }
        
        .stats-display {
            background: rgba(241, 196, 15, 0.2);
            border: 2px solid #f1c40f;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .elimination-summary {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .lock-ability {
            background: rgba(155, 89, 182, 0.2);
            border: 2px solid #9b59b6;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .nav-buttons {
            text-align: center;
            margin-top: 25px;
            padding: 10px 0;
        }

        .day1-special {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .dropdown-section {
            margin: 15px 0;
        }

        .dropdown-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #bdc3c7;
            font-size: 14px;
        }

        .bullet-squares-container {
            margin: 15px 0;
        }

        .bullet-squares {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            justify-content: center;
            margin: 15px 0;
        }

        .bullet-square-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bullet-label-top {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .bullet-square {
            width: 100%;
            min-height: 80px;
            border: 3px dashed #3498db;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(52, 152, 219, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .bullet-square.drag-over {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
            transform: scale(1.02);
        }

        .bullet-square.has-player {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.2);
            border-style: solid;
        }

        .bullet-square.elimination-target {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.3);
            border-style: solid;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        .bullet-square.elimination-target .bullet-label-top {
            color: #e74c3c;
        }

        .drop-zone {
            font-size: 11px;
            color: #95a5a6;
            text-align: center;
            padding: 5px;
        }

        .bullet-square .player-in-square {
            font-weight: bold;
            color: #2c3e50;
            background: #ecf0f1;
            padding: 8px 10px;
            border-radius: 12px;
            font-size: 12px;
            text-align: center;
            position: absolute;
            cursor: pointer;
            max-width: 90%;
            word-wrap: break-word;
        }

        /* Bullet Selection Buttons */
        .bullet-selection {
            margin: 15px 0;
        }

        .bullet-selection h3 {
            margin-bottom: 15px;
        }

        .bullet-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .bullet-button {
            background: rgba(52, 73, 94, 0.8);
            color: #bdc3c7;
            border: 2px solid rgba(149, 165, 166, 0.3);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .bullet-button:hover {
            background: rgba(52, 152, 219, 0.4);
            border-color: #3498db;
        }

        .bullet-button.selected {
            background: #3498db;
            color: #ecf0f1;
            border-color: #2980b9;
        }

        /* Night Action Tabs */
        .night-tabs {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 2px solid #3498db;
            margin-bottom: 20px;
        }
        
        .night-tab {
            background: rgba(52, 73, 94, 0.6);
            border: none;
            padding: 12px 16px;
            margin: 0 2px;
            color: #bdc3c7;
            cursor: pointer;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .night-tab.eliminated {
            background: rgba(231, 76, 60, 0.6);
            color: #e74c3c;
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .night-tab.eliminated.active {
            background: #e74c3c;
            color: #ecf0f1;
            text-decoration: line-through;
        }
        
        .night-tab.active {
            background: #3498db;
            color: #ecf0f1;
            transform: translateY(-2px);
        }
        
        .night-tab:hover {
            background: rgba(52, 152, 219, 0.7);
            color: #ecf0f1;
        }
        
        .night-tab-content {
            display: none;
        }
        
        .night-tab-content.active {
            display: block;
        }
        
        .night-player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .night-player-item {
            background: rgba(52, 73, 94, 0.8);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(149, 165, 166, 0.2);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .night-player-item:hover:not(.eliminated) {
            transform: translateY(-2px);
            background: rgba(52, 152, 219, 0.4);
        }
        
        .night-player-item.eliminated {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            text-decoration: line-through;
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .night-player-item.selected {
            background: rgba(39, 174, 96, 0.4);
            border-color: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.3);
        }
        
        .night-role-display {
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }
        
        /* Mobile specific adjustments */
        /* Method selection buttons */
        .method-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .method-button {
            background: rgba(52, 73, 94, 0.8);
            color: #bdc3c7;
            border: 2px solid rgba(149, 165, 166, 0.3);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .method-button:hover {
            background: rgba(52, 152, 219, 0.4);
            border-color: #3498db;
        }
        
        .method-button.selected {
            background: #3498db;
            color: #ecf0f1;
            border-color: #2980b9;
        }

        .method-button:disabled {
            background: rgba(52, 73, 94, 0.4);
            color: #95a5a6;
            border-color: rgba(149, 165, 166, 0.1);
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .certainty-buttons {
            display: none;
            gap: 10px;
            margin: 10px 0;
            justify-content: center;
        }
        
        .certainty-button {
            background: rgba(155, 89, 182, 0.6);
            color: #bdc3c7;
            border: 2px solid rgba(155, 89, 182, 0.4);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .certainty-button:hover {
            background: rgba(155, 89, 182, 0.8);
            border-color: #9b59b6;
        }
        
        .certainty-button.selected {
            background: #9b59b6;
            color: #ecf0f1;
            border-color: #8e44ad;
        }
            body {
                padding: 5px;
                font-size: 13px;
            }
            
            .container {
                padding: 10px;
                border-radius: 10px;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            
            h2 {
                font-size: 1.1em;
            }
            
            .player-grid {
                grid-template-columns: 1fr;
            }
            
            .bullet-squares {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .bullet-buttons {
                flex-direction: row;
            }
            
            .night-tabs {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .night-tab {
                margin: 2px;
                border-radius: 8px;
            }
            
            .night-player-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }
            
            .method-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .certainty-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .player-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        /* Additional mobile optimizations */
        .nav-buttons button {
            margin: 5px;
            width: calc(50% - 10px);
        }
        
        @media (max-width: 480px) {
            .nav-buttons button {
                width: 100%;
                margin: 5px 0;
            }
            
            .player-select {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .role-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .role-item input[type="number"] {
                align-self: flex-end;
            }
            
            .night-player-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .method-buttons {
                flex-direction: row;
            }
            
            .certainty-buttons {
                flex-direction: row;
            }
            
            .night-tabs {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .bullet-squares {
                grid-template-columns: 1fr 1fr;
            }

            .bullet-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .player-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Game Statistics Header (shown on all pages after setup) -->
        <div class="game-stats-header" id="gameStatsHeader" style="display: none;">
            <div id="gameStatsContent">
                <!-- Game statistics will be shown here -->
            </div>
        </div>

        <!-- Page 1: Role Selection -->
        <div class="page active" id="page1">
            <h1>🎭 Mafia Game Setup 💣</h1>
            <h2>Select Roles</h2>
            <div class="role-grid" id="roleGrid">
                <!-- This will be populated by JavaScript -->
            </div>
            <div class="total-players" id="totalPlayers">
                Total Players: 0
            </div>
            <div class="nav-buttons">
                <button onclick="goToPage(2)" id="nextToPlayers">Next: Enter Players</button>
            </div>
        </div>

        <!-- Page 2: Player Names -->
        <div class="page" id="page2">
            <h1>Enter Player Names</h1>
            <div id="playerInputs">
                <!-- Player inputs will be generated by JavaScript -->
            </div>
            <div class="nav-buttons">
                <button onclick="goToPage(1)">Back</button>
                <button onclick="goToPage(3)" id="nextToAssign">Next: Assign Roles</button>
            </div>
        </div>

        <!-- Page 3: Role Assignment -->
        <div class="page" id="page3">
            <h1>Role Assignments</h1>
            <div id="roleAssignments">
                <!-- Role assignments will be generated by JavaScript -->
            </div>
            <div class="nav-buttons">
                <button onclick="goToPage(2)">Back</button>
                <button onclick="goToPage(4)">Next: Day 1 Elimination</button>
            </div>
        </div>

        <!-- Page 4: Day Elimination -->
        <div class="page" id="page4">
            <h1 id="dayTitle">Day 1 - Elimination</h1>
            
            <!-- Day 1 Special Mechanics -->
            <div class="day1-special" id="day1Special" style="display: none;">
                <h2>Day 1 Special Mechanics</h2>
                <div class="bullet-selection">
                    <h3>Mafia Live Bullet Selection:</h3>
                    <div class="bullet-buttons">
                        <button class="bullet-button" id="bullet1Button" onclick="selectBullet('bullet1')">Bullet 1</button>
                        <button class="bullet-button" id="bullet2Button" onclick="selectBullet('bullet2')">Bullet 2</button>
                    </div>
                </div>
                
                <div class="bullet-squares-container">
                    <h3>Drag players into bullet squares:</h3>
                    <div class="bullet-squares">
                        <div class="bullet-square-wrapper">
                            <div class="bullet-label-top">Bullet 1</div>
                            <div class="bullet-square" id="bullet1Square" data-bullet="bullet1">
                                <div class="drop-zone">Drop player here</div>
                            </div>
                        </div>
                        <div class="bullet-square-wrapper">
                            <div class="bullet-label-top">Bullet 2</div>
                            <div class="bullet-square" id="bullet2Square" data-bullet="bullet2">
                                <div class="drop-zone">Drop player here</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Player Pool with Names and Roles -->
                <div class="player-list-header">
                    <h3>Players</h3>
                    <div class="player-grid" id="day1PlayersGrid">
                        <!-- Players will be populated here -->
                    </div>
                </div>
                
                <div id="bulletResult"></div>
            </div>

            <div class="elimination-section" id="eliminationSection">
                <h2>Select player to eliminate:</h2>
                
                <!-- Player Pool for Day 2+ -->
                <div class="player-list-header" id="day2PlusPlayersHeader" style="display: none;">
                    <h3>Players</h3>
                    <div class="player-grid" id="day2PlusPlayersGrid">
                        <!-- Players will be populated here -->
                    </div>
                </div>
                
                <div id="dayEliminatedRole"></div>
            </div>

            <div class="lock-ability" id="lockAbilitySection" style="display: none;">
                <h2>Lock Player's Ability (One time use)</h2>
                <div class="dropdown-section">
                    <label for="lockAbilitySelect">Select player to lock:</label>
                    <select id="lockAbilitySelect">
                        <option value="">Select player to lock</option>
                    </select>
                </div>
                <div id="lockedPlayer"></div>
            </div>

            <div class="lock-ability" id="additionalEliminationSection" style="display: none;">
                <h2>Additional Player Elimination</h2>
                <div class="dropdown-section">
                    <label for="additionalEliminationSelect">Select additional player to eliminate:</label>
                    <select id="additionalEliminationSelect">
                        <option value="">No additional elimination</option>
                    </select>
                </div>
                <div id="additionalEliminatedPlayer"></div>
            </div>

            <div class="lock-ability" id="roleSwapSection" style="display: none;">
                <h2>Role Swap</h2>
                <div class="dropdown-section">
                    <label for="roleSwapSelect">Swap eliminated player's role with:</label>
                    <select id="roleSwapSelect">
                        <option value="">No role swap</option>
                    </select>
                </div>
                <div id="roleSwapResult"></div>
            </div>

            <div class="nav-buttons">
                <button onclick="goToPage(3)">Back</button>
                <button onclick="goToNight()">Next: Night Actions</button>
            </div>
        </div>

        <!-- Page 5: Night Actions -->
        <div class="page" id="page5">
            <h1 id="nightTitle">Night 1</h1>
            
            <!-- Night Tabs -->
            <div class="night-tabs" id="nightTabs">
                <!-- Tabs will be generated by JavaScript -->
            </div>
            
            <div id="nightTabsContent">
                <!-- Tab contents will be generated by JavaScript -->
            </div>
            
            <div class="nav-buttons">
                <button onclick="goToPage(4)">Back</button>
                <button onclick="processNight()">Process Night & Continue</button>
            </div>
        </div>

        <!-- Page 6: Night Summary -->
        <div class="page" id="page6">
            <h1 id="summaryTitle">Night 1 Summary</h1>
            <div id="nightResults">
                <!-- Night results will be shown here -->
            </div>
            <div class="elimination-summary" id="eliminationSummary" style="display: none;">
                <!-- Elimination summary will be shown here -->
            </div>
            <div class="nav-buttons">
                <button onclick="revealEliminationCount()" id="revealBtn">Reveal Elimination Count</button>
                <button onclick="goToNextDay()">Next Day</button>
            </div>
        </div>
    </div>

    <script>
        // Game state object
        const gameState = {
            roles: {
                'Jailer': 1,
                'Godfather - Mafia': 1,
                'Executioner - Mafia': 1,
                'Regular Mafia': 0,
                'Shooter': 1,
                'Doctor': 1,
                'Psychiatrist': 1,
                'Detective': 1,
                'Ghost': 1,
                'Master of Disguise': 1,
                'Civilian': 0,
                'Devotee': 1
            },
            players: [],
            assignments: {},
            eliminated: [],
            currentPage: 1,
            dayNumber: 1,
            nightNumber: 1,
            jailerUsesLeft: 2,
            doctorSelfSaveUsed: false,
            shooterUsesLeft: 2,
            shooterShieldActive: true,
            godfatherShieldActive: true,
            godfatherAttackCount: 0,
            masterOfDisguiseSelection: null,
            masterOfDisguiseTransformed: false,
            eliminationCountRevealsLeft: 2,
            eliminationCountRevealed: false,
            lockedPlayer: null,
            lockAbilityUsed: false,
            jailedPlayers: {},
            selectedForElimination: null,
            modTransformation: null,
            previousPage: 1,
            savedThisNight: [],
            nightSelections: {}, // Store night selections per role
            selectedBullet: null // New property to track selected bullet
        };

        const defaultNames = [
            "Reza", "Khodadad Ahmadi", "Ahmad Taheri", "Alireza Jafari", 
            "Hamid Shahabi", "Sayed Ahmad", "Haidar Fazeli", "Asef Ghafori", 
            "Jafar Nazari", "Qomandan"
        ];

        // Update game statistics header (shown on all pages after night 1)
        function updateGameStatsHeader() {
            const header = document.getElementById('gameStatsHeader');
            const content = document.getElementById('gameStatsContent');
            
            if (gameState.nightNumber > 1 || gameState.currentPage >= 5) {
                const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
                const aliveRoles = {};
                const eliminatedRoles = {};
                
                alivePlayers.forEach(player => {
                    const role = gameState.assignments[player];
                    if (!aliveRoles[role]) aliveRoles[role] = 0;
                    aliveRoles[role]++;
                });
                
                gameState.eliminated.forEach(player => {
                    const role = gameState.assignments[player];
                    if (!eliminatedRoles[role]) eliminatedRoles[role] = 0;
                    eliminatedRoles[role]++;
                });
                
                const aliveMafia = (aliveRoles['Godfather - Mafia'] || 0) + 
                                  (aliveRoles['Executioner - Mafia'] || 0) + 
                                  (aliveRoles['Regular Mafia'] || 0);
                
                const aliveNonMafia = alivePlayers.length - aliveMafia;
                
                const eliminatedMafia = (eliminatedRoles['Godfather - Mafia'] || 0) + 
                                       (eliminatedRoles['Executioner - Mafia'] || 0) + 
                                       (eliminatedRoles['Regular Mafia'] || 0);
                
                const eliminatedNonMafia = gameState.eliminated.length - eliminatedMafia;
                
                content.innerHTML = `
                    <strong>Day ${gameState.dayNumber} | Night ${gameState.nightNumber}</strong><br>
                    <strong>Alive:</strong> Mafia = ${aliveMafia}, Non-mafia = ${aliveNonMafia}, Total = ${alivePlayers.length}<br>
                    <strong>Eliminated:</strong> Mafia = ${eliminatedMafia}, Non-mafia = ${eliminatedNonMafia}, Total = ${gameState.eliminated.length}
                `;
                
                header.style.display = 'block';
            } else {
                header.style.display = 'none';
            }
        }

        // Initialize role selection grid
        function initializeRoleSelection() {
            console.log("Initializing role selection...");
            const roleGrid = document.getElementById('roleGrid');
            
            if (!roleGrid) {
                console.error("Role grid not found!");
                return;
            }
            
            roleGrid.innerHTML = '';
            
            Object.keys(gameState.roles).forEach(role => {
                const roleItem = document.createElement('div');
                roleItem.className = 'role-item';
                
                const maxValue = (role === 'Regular Mafia' || role === 'Civilian') ? 10 : 1;
                const currentValue = gameState.roles[role];
                
                roleItem.innerHTML = `
                    <span class="role-name">${role}</span>
                    <input type="number" min="0" max="${maxValue}" value="${currentValue}" 
                           onchange="updateRoleCount('${role}', this.value)">
                `;
                roleGrid.appendChild(roleItem);
            });
            
            updateTotalPlayers();
            console.log("Role selection initialized successfully");
        }

        // Update role count when user changes input
        function updateRoleCount(role, value) {
            const numValue = parseInt(value) || 0;
            gameState.roles[role] = numValue;
            updateTotalPlayers();
        }

        // Update total player count display
        function updateTotalPlayers() {
            const total = Object.values(gameState.roles).reduce((sum, count) => sum + count, 0);
            const totalElement = document.getElementById('totalPlayers');
            if (totalElement) {
                totalElement.textContent = `Total Players: ${total}`;
            }
        }

        // Navigate between pages
        function goToPage(pageNum) {
            gameState.previousPage = gameState.currentPage;
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`page${pageNum}`);
            if (targetPage) {
                targetPage.classList.add('active');
                gameState.currentPage = pageNum;
                
                updateGameStatsHeader();
                
                if (pageNum === 2) {
                    generatePlayerInputs();
                } else if (pageNum === 3) {
                    assignRoles();
                } else if (pageNum === 4) {
                    setupDayElimination();
                } else if (pageNum === 5) {
                    setupNightActions();
                }
            }
        }

        // Generate player input fields
        function generatePlayerInputs() {
            const totalPlayers = Object.values(gameState.roles).reduce((sum, count) => sum + count, 0);
            const playerInputsContainer = document.getElementById('playerInputs');
            
            if (!playerInputsContainer) return;
            
            playerInputsContainer.innerHTML = '';
            
            const sortedDefaultNames = [...defaultNames].sort();
            
            for (let i = 0; i < totalPlayers; i++) {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'player-input';
                
                const defaultName = i < sortedDefaultNames.length ? sortedDefaultNames[i] : `Player ${i + 1}`;
                
                inputDiv.innerHTML = `
                    <label>Player ${i + 1}:</label>
                    <input type="text" id="player${i}" value="${defaultName}">
                `;
                playerInputsContainer.appendChild(inputDiv);
            }
        }

        // Assign roles to players
        function assignRoles() {
            gameState.players = [];
            const totalPlayers = Object.values(gameState.roles).reduce((sum, count) => sum + count, 0);
            
            for (let i = 0; i < totalPlayers; i++) {
                const playerInput = document.getElementById(`player${i}`);
                if (playerInput) {
                    const name = playerInput.value.trim();
                    if (name) {
                        gameState.players.push(name);
                    }
                }
            }
            
            gameState.players.sort();
            
            let rolePool = [];
            Object.entries(gameState.roles).forEach(([role, count]) => {
                if (count > 0) {
                    for (let i = 0; i < count; i++) {
                        rolePool.push(role);
                    }
                }
            });
            
            rolePool = shuffleArray(rolePool);
            gameState.assignments = {};
            gameState.players.forEach((player, index) => {
                if (index < rolePool.length) {
                    gameState.assignments[player] = rolePool[index];
                }
            });
            
            displayRoleAssignments();
        }

        // Shuffle array function
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Display role assignments with reveal buttons
        function displayRoleAssignments() {
            const container = document.getElementById('roleAssignments');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-role-item';
                
                item.innerHTML = `
                    <span><strong>${player}</strong></span>
                    <div>
                        <span class="hidden-role" id="role-${player}">Click to reveal role</span>
                        <button class="role-reveal" onclick="toggleRole('${player}')">Reveal</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Toggle role visibility
        function toggleRole(player) {
            const roleSpan = document.getElementById(`role-${player}`);
            const button = roleSpan.nextElementSibling;
            
            if (!roleSpan || !button) return;
            
            gameState.players.forEach(p => {
                if (p !== player) {
                    const otherRoleSpan = document.getElementById(`role-${p}`);
                    const otherButton = otherRoleSpan ? otherRoleSpan.nextElementSibling : null;
                    if (otherRoleSpan && otherButton) {
                        otherRoleSpan.textContent = 'Click to reveal role';
                        otherRoleSpan.className = 'hidden-role';
                        otherButton.textContent = 'Reveal';
                        otherButton.className = 'role-reveal';
                    }
                }
            });
            
            if (roleSpan.classList.contains('hidden-role')) {
                roleSpan.textContent = gameState.assignments[player] || 'No role assigned';
                roleSpan.className = '';
                button.textContent = 'Hide';
                button.className = 'role-reveal role-revealed';
            } else {
                roleSpan.textContent = 'Click to reveal role';
                roleSpan.className = 'hidden-role';
                button.textContent = 'Reveal';
                button.className = 'role-reveal';
            }
        }

        // Setup Day Elimination
        function setupDayElimination() {
            if (gameState.dayNumber === 1) {
                document.getElementById('day1Special').style.display = 'block';
                document.getElementById('eliminationSection').style.display = 'none';
                setupDay1Mechanics();
            } else {
                document.getElementById('day1Special').style.display = 'none';
                document.getElementById('eliminationSection').style.display = 'block';
                setupDay2PlusElimination();
            }
            
            if (gameState.dayNumber > 1 && !gameState.lockAbilityUsed) {
                document.getElementById('lockAbilitySection').style.display = 'block';
                setupLockAbility();
                document.getElementById('additionalEliminationSection').style.display = 'block';
                setupAdditionalElimination();
                document.getElementById('roleSwapSection').style.display = 'block';
                setupRoleSwap();
            } else {
                document.getElementById('lockAbilitySection').style.display = 'none';
                document.getElementById('additionalEliminationSection').style.display = 'none';
                document.getElementById('roleSwapSection').style.display = 'none';
            }
        }

        function setupDay1Mechanics() {
            setupDay1PlayersGrid();
            setupDropZones();
        }

        // New function to handle bullet selection
        function selectBullet(bullet) {
            // Remove selected class from all bullet buttons
            document.getElementById('bullet1Button').classList.remove('selected');
            document.getElementById('bullet2Button').classList.remove('selected');
            
            // Add selected class to clicked button
            document.getElementById(bullet + 'Button').classList.add('selected');
            
            // Update game state
            gameState.selectedBullet = bullet;
            
            // Check bullet match with current setup
            checkBulletMatch();
        }

        function setupDay1PlayersGrid() {
            const container = document.getElementById('day1PlayersGrid');
            container.innerHTML = '';
            
            // Make the container a drop zone for players being dragged back
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                container.style.backgroundColor = 'rgba(39, 174, 96, 0.2)';
                container.style.borderColor = '#27ae60';
            });
            
            container.addEventListener('dragleave', (e) => {
                if (!container.contains(e.relatedTarget)) {
                    container.style.backgroundColor = 'rgba(52, 152, 219, 0.2)';
                    container.style.borderColor = '#3498db';
                }
            });
            
            container.addEventListener('drop', (e) => {
                e.preventDefault();
                const player = e.dataTransfer.getData('text/plain');
                
                removePlayerFromAllLocations(player);
                
                const playerDiv = container.querySelector(`[data-player="${player}"]`);
                if (!playerDiv) {
                    addPlayerToGrid(player, container);
                }
                
                container.style.backgroundColor = 'rgba(52, 152, 219, 0.2)';
                container.style.borderColor = '#3498db';
                
                checkBulletMatch();
            });
            
            gameState.players.forEach(player => {
                addPlayerToGrid(player, container);
            });
        }

        function setupDay2PlusElimination() {
            const header = document.getElementById('day2PlusPlayersHeader');
            const container = document.getElementById('day2PlusPlayersGrid');
            
            header.style.display = 'block';
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.dataset.player = player;
                
                if (gameState.eliminated.includes(player)) {
                    playerDiv.classList.add('eliminated');
                } else {
                    playerDiv.onclick = () => selectForElimination(player);
                }
                
                const role = gameState.assignments[player] || 'No role';
                playerDiv.innerHTML = `
                    <strong>${player}</strong><br>
                    <span style="color: #95a5a6; font-size: 12px;">${role}</span>
                `;
                container.appendChild(playerDiv);
            });
        }

        function addPlayerToGrid(player, container) {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-item';
            playerDiv.textContent = player;
            playerDiv.draggable = true;
            playerDiv.dataset.player = player;
            
            const role = gameState.assignments[player] || 'No role';
            playerDiv.innerHTML = `
                <strong>${player}</strong><br>
                <span style="color: #95a5a6; font-size: 12px;">${role}</span>
            `;
            
            playerDiv.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', player);
                playerDiv.classList.add('dragging');
            });
            
            playerDiv.addEventListener('dragend', () => {
                playerDiv.classList.remove('dragging');
            });
            
            container.appendChild(playerDiv);
        }

        function setupDropZones() {
            const bullet1Square = document.getElementById('bullet1Square');
            const bullet2Square = document.getElementById('bullet2Square');
            
            [bullet1Square, bullet2Square].forEach(square => {
                square.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    square.classList.add('drag-over');
                });
                
                square.addEventListener('dragleave', (e) => {
                    square.classList.remove('drag-over');
                });
                
                square.addEventListener('drop', (e) => {
                    e.preventDefault();
                    square.classList.remove('drag-over');
                    
                    const player = e.dataTransfer.getData('text/plain');
                    
                    const existingPlayerInSquare = square.querySelector('.player-in-square');
                    let displacedPlayer = null;
                    
                    if (existingPlayerInSquare) {
                        displacedPlayer = existingPlayerInSquare.dataset.player;
                    }
                    
                    removePlayerFromAllLocations(player);
                    
                    addPlayerToSquare(square, player);
                    
                    if (displacedPlayer && displacedPlayer !== player) {
                        addPlayerToGrid(displacedPlayer, document.getElementById('day1PlayersGrid'));
                    }
                    
                    checkBulletMatch();
                });
                
                square.addEventListener('click', (e) => {
                    if (e.target.classList.contains('player-in-square')) {
                        const player = e.target.dataset.player;
                        removePlayerFromSquare(square);
                        addPlayerToGrid(player, document.getElementById('day1PlayersGrid'));
                        checkBulletMatch();
                    }
                });
            });
        }

        function removePlayerFromAllLocations(player) {
            // Remove from grid
            const grids = [document.getElementById('day1PlayersGrid')];
            grids.forEach(grid => {
                if (grid) {
                    const playerDiv = grid.querySelector(`[data-player="${player}"]`);
                    if (playerDiv) {
                        playerDiv.remove();
                    }
                }
            });
            
            // Remove from squares
            const squares = [document.getElementById('bullet1Square'), document.getElementById('bullet2Square')];
            squares.forEach(square => {
                const existingPlayer = square.querySelector('.player-in-square');
                if (existingPlayer && existingPlayer.dataset.player === player) {
                    removePlayerFromSquare(square);
                }
            });
        }

        function addPlayerToSquare(square, player) {
            removePlayerFromSquare(square);
            
            const role = gameState.assignments[player] || 'No role';
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-in-square';
            playerDiv.innerHTML = `
                <strong>${player}</strong><br>
                <span style="font-size: 10px; color: #7f8c8d;">${role}</span>
            `;
            playerDiv.dataset.player = player;
            playerDiv.title = 'Click to remove or drag back to player pool';
            playerDiv.draggable = true;
            
            playerDiv.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', player);
                playerDiv.classList.add('dragging');
            });
            
            playerDiv.addEventListener('dragend', () => {
                playerDiv.classList.remove('dragging');
            });
            
            square.appendChild(playerDiv);
            square.classList.add('has-player');
            
            const dropZone = square.querySelector('.drop-zone');
            if (dropZone) dropZone.style.display = 'none';
        }

        function removePlayerFromSquare(square) {
            const existingPlayer = square.querySelector('.player-in-square');
            if (existingPlayer) {
                const player = existingPlayer.dataset.player;
                existingPlayer.remove();
                square.classList.remove('has-player');
                
                const dropZone = square.querySelector('.drop-zone');
                if (dropZone) dropZone.style.display = 'block';
                
                return player;
            }
            return null;
        }

        function checkBulletMatch() {
            const selectedBullet = gameState.selectedBullet;
            const resultDiv = document.getElementById('bulletResult');
            const bullet1Square = document.getElementById('bullet1Square');
            const bullet2Square = document.getElementById('bullet2Square');
            const bullet1Wrapper = bullet1Square.closest('.bullet-square-wrapper');
            const bullet2Wrapper = bullet2Square.closest('.bullet-square-wrapper');
            
            bullet1Square.classList.remove('elimination-target');
            bullet2Square.classList.remove('elimination-target');
            bullet1Wrapper.querySelector('.bullet-label-top').style.color = '#3498db';
            bullet2Wrapper.querySelector('.bullet-label-top').style.color = '#3498db';
            
            if (!selectedBullet) {
                resultDiv.innerHTML = '';
                return;
            }
            
            const matchingSquare = document.getElementById(selectedBullet + 'Square');
            const matchingWrapper = matchingSquare.closest('.bullet-square-wrapper');
            const playerInSquare = matchingSquare ? matchingSquare.querySelector('.player-in-square') : null;
            
            if (playerInSquare) {
                const player = playerInSquare.dataset.player;
                const playerRole = gameState.assignments[player];
                
                matchingSquare.classList.add('elimination-target');
                matchingWrapper.querySelector('.bullet-label-top').style.color = '#e74c3c';
                
                resultDiv.innerHTML = `<div class="eliminated-role">${player} - ${playerRole} is in ${selectedBullet.charAt(0).toUpperCase() + selectedBullet.slice(1)} and will be eliminated!</div>`;
            } else {
                resultDiv.innerHTML = `<div style="background: rgba(39, 174, 96, 0.2); border: 2px solid #27ae60; padding: 15px; margin-top: 20px; border-radius: 10px; text-align: center; font-size: 18px;">No player in ${selectedBullet.charAt(0).toUpperCase() + selectedBullet.slice(1)} - no elimination!</div>`;
            }
        }

        function selectForElimination(player) {
            // Remove previous selections
            document.querySelectorAll('#day2PlusPlayersGrid .player-item').forEach(item => {
                item.classList.remove('selected');
                item.style.backgroundColor = '';
            });
            
            if (gameState.selectedForElimination === player) {
                gameState.selectedForElimination = null;
                document.getElementById('dayEliminatedRole').innerHTML = '';
            } else {
                gameState.selectedForElimination = player;
                const playerDiv = document.querySelector(`#day2PlusPlayersGrid [data-player="${player}"]`);
                if (playerDiv) {
                    playerDiv.style.backgroundColor = 'rgba(231, 76, 60, 0.4)';
                }
                
                document.getElementById('dayEliminatedRole').innerHTML = `
                    <div class="eliminated-role">
                        ${player} - ${gameState.assignments[player]}
                    </div>
                `;
            }
            
            const roleSwapSelect = document.getElementById('roleSwapSelect');
            if (roleSwapSelect && roleSwapSelect.value) {
                const resultDiv = document.getElementById('roleSwapResult');
                if (gameState.selectedForElimination) {
                    resultDiv.innerHTML = `
                        <div class="eliminated-role">
                            ${gameState.selectedForElimination}'s role will be swapped with ${roleSwapSelect.value}
                        </div>
                    `;
                }
            }
        }

        function setupLockAbility() {
            const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
            const select = document.getElementById('lockAbilitySelect');
            
            select.innerHTML = '<option value="">Select player to lock</option>';
            
            alivePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player;
                option.textContent = player;
                select.appendChild(option);
            });
            
            select.onchange = function() {
                const selectedPlayer = this.value;
                const resultDiv = document.getElementById('lockedPlayer');
                
                if (selectedPlayer) {
                    gameState.lockedPlayer = selectedPlayer;
                    resultDiv.innerHTML = `
                        <div class="eliminated-role">
                            ${selectedPlayer}'s ability will be locked for the next night
                        </div>
                    `;
                } else {
                    gameState.lockedPlayer = null;
                    resultDiv.innerHTML = '';
                }
            };
        }

        function setupAdditionalElimination() {
            const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
            const select = document.getElementById('additionalEliminationSelect');
            
            select.innerHTML = '<option value="">No additional elimination</option>';
            
            alivePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player;
                option.textContent = player;
                select.appendChild(option);
            });
            
            select.onchange = function() {
                const selectedPlayer = this.value;
                const resultDiv = document.getElementById('additionalEliminatedPlayer');
                
                if (selectedPlayer) {
                    resultDiv.innerHTML = `
                        <div class="eliminated-role">
                            ${selectedPlayer} will be additionally eliminated
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '';
                }
            };
        }

        function setupRoleSwap() {
            const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
            const select = document.getElementById('roleSwapSelect');
            
            select.innerHTML = '<option value="">No role swap</option>';
            
            alivePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player;
                option.textContent = player;
                select.appendChild(option);
            });
            
            select.onchange = function() {
                const selectedPlayer = this.value;
                const resultDiv = document.getElementById('roleSwapResult');
                
                if (selectedPlayer && gameState.selectedForElimination) {
                    resultDiv.innerHTML = `
                        <div class="eliminated-role">
                            ${gameState.selectedForElimination}'s role will be swapped with ${selectedPlayer}
                        </div>
                    `;
                } else if (selectedPlayer) {
                    resultDiv.innerHTML = `
                        <div class="eliminated-role">
                            Select a player for elimination first to see role swap details
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '';
                }
            };
        }

        function goToNight() {
            // Handle Day 1 bullet mechanics
            if (gameState.dayNumber === 1) {
                const selectedBullet = gameState.selectedBullet;
                
                if (selectedBullet) {
                    const matchingSquare = document.getElementById(selectedBullet + 'Square');
                    const playerInSquare = matchingSquare ? matchingSquare.querySelector('.player-in-square') : null;
                    
                    if (playerInSquare) {
                        const playerToEliminate = playerInSquare.dataset.player;
                        gameState.eliminated.push(playerToEliminate);
                    }
                }
            } else {
                if (gameState.selectedForElimination) {
                    gameState.eliminated.push(gameState.selectedForElimination);
                }
                
                const additionalElimination = document.getElementById('additionalEliminationSelect').value;
                if (additionalElimination) {
                    gameState.eliminated.push(additionalElimination);
                }
                
                const roleSwapTarget = document.getElementById('roleSwapSelect').value;
                if (roleSwapTarget && gameState.selectedForElimination) {
                    const eliminatedRole = gameState.assignments[gameState.selectedForElimination];
                    const swapTargetRole = gameState.assignments[roleSwapTarget];
                    
                    gameState.assignments[gameState.selectedForElimination] = swapTargetRole;
                    gameState.assignments[roleSwapTarget] = eliminatedRole;
                }
                
                if (gameState.lockedPlayer) {
                    gameState.lockAbilityUsed = true;
                }
            }
            
            document.getElementById('nightTitle').textContent = `Night ${gameState.nightNumber}`;
            goToPage(5);
        }

        function setupNightActions() {
            const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
            const allPlayers = gameState.players;
            const aliveRoles = {};
            const allRoles = {};
            
            alivePlayers.forEach(player => {
                const role = gameState.assignments[player];
                if (!aliveRoles[role]) aliveRoles[role] = [];
                aliveRoles[role].push(player);
            });
            
            allPlayers.forEach(player => {
                const role = gameState.assignments[player];
                if (!allRoles[role]) allRoles[role] = [];
                allRoles[role].push(player);
            });
            
            // Create tabs
            createNightTabs(allRoles, aliveRoles);
            
            // Show first tab content by default
            setTimeout(() => {
                showFirstTab();
            }, 50);
        }

        function createNightTabs(allRoles, aliveRoles) {
            const tabsContainer = document.getElementById('nightTabs');
            const contentContainer = document.getElementById('nightTabsContent');
            
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';
            
            const roleOrder = [
                'Master of Disguise',
                'Jailer', 
                'Godfather - Mafia', 
                'Executioner - Mafia', 
                'Regular Mafia',
                'Doctor',
                'Shooter',
                'Detective',
                'Devotee',
                'Psychiatrist'
            ];
            
            let firstTab = true;
            let mafiaTabCreated = false;
            
            roleOrder.forEach(role => {
                if (allRoles[role]) {
                    const playersWithRole = allRoles[role];
                    const alivePlayersWithRole = aliveRoles[role] || [];
                    
                    // Handle mafia roles together
                    if (['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'].includes(role)) {
                        if (!mafiaTabCreated) {
                            const mafiaMembers = [];
                            ['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'].forEach(mafiaRole => {
                                if (aliveRoles[mafiaRole]) {
                                    mafiaMembers.push(...aliveRoles[mafiaRole]);
                                }
                            });
                            
                            createNightTab('Mafia', mafiaMembers.length > 0, firstTab);
                            createMafiaTabContent(mafiaMembers, allRoles, aliveRoles);
                            mafiaTabCreated = true;
                            firstTab = false;
                        }
                    } else {
                        const isActive = alivePlayersWithRole.length > 0;
                        const shouldShow = role === 'Master of Disguise' ? 
                            (gameState.nightNumber === 1 && !gameState.masterOfDisguiseTransformed) : 
                            true;
                        
                        if (shouldShow) {
                            createNightTab(role, isActive, firstTab);
                            createRoleTabContent(role, playersWithRole, alivePlayersWithRole, isActive);
                            firstTab = false;
                        }
                    }
                }
            });
        }

        function createNightTab(roleName, isActive, isFirst) {
            const tabsContainer = document.getElementById('nightTabs');
            const tab = document.createElement('button');
            tab.className = 'night-tab' + (isFirst ? ' active' : '');
            tab.textContent = roleName;
            tab.dataset.role = roleName;
            tab.style.opacity = isActive ? '1' : '0.5';
            
            // Check if this role is eliminated
            const roleHasAlivePlayers = gameState.players.some(player => 
                gameState.assignments[player] === roleName && !gameState.eliminated.includes(player)
            );
            
            // For mafia tab, check if any mafia member is alive
            if (roleName === 'Mafia') {
                const mafiaRoles = ['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'];
                const aliveMafiaExists = gameState.players.some(player => 
                    mafiaRoles.includes(gameState.assignments[player]) && !gameState.eliminated.includes(player)
                );
                if (!aliveMafiaExists) {
                    tab.classList.add('eliminated');
                }
            } else if (!roleHasAlivePlayers) {
                tab.classList.add('eliminated');
            }
            
            tab.onclick = () => switchNightTab(roleName);
            tabsContainer.appendChild(tab);
        }

        function createRoleTabContent(role, allPlayersWithRole, alivePlayersWithRole, isActive) {
            const contentContainer = document.getElementById('nightTabsContent');
            const content = document.createElement('div');
            content.className = 'night-tab-content';
            content.id = `tab-${role}`;
            
            // Show role name and player
            content.innerHTML = `<div class="night-role-display">${role}</div>`;
            
            if (alivePlayersWithRole.length > 0) {
                const player = alivePlayersWithRole[0];
                const isLocked = gameState.lockedPlayer === player;
                
                let playerDisplay = `<div class="player-name-display">${player}</div>`;
                
                if (gameState.modTransformation && gameState.modTransformation.role === role) {
                    playerDisplay = `
                        <div class="player-name-display">
                            <span style="text-decoration: line-through; color: #999;">${gameState.modTransformation.originalPlayer}</span><br>
                            <span style="color: #87ceeb; font-weight: bold;">${gameState.modTransformation.newPlayer}</span>
                        </div>
                    `;
                }
                
                content.innerHTML += playerDisplay;
                
                if (isLocked) {
                    content.innerHTML += '<div class="jailed-message">Ability locked for this night</div>';
                }
                
                // Add special messages for roles with limited uses
                if (role === 'Jailer' && gameState.jailerUsesLeft === 0) {
                    content.innerHTML += '<div class="jailed-message">No uses left</div>';
                } else if (role === 'Shooter' && gameState.shooterUsesLeft === 0) {
                    content.innerHTML += '<div class="jailed-message">No uses left</div>';
                }
                
                // Create player grid for target selection
                if (!isLocked && !(role === 'Jailer' && gameState.jailerUsesLeft === 0) && 
                    !(role === 'Shooter' && gameState.shooterUsesLeft === 0) &&
                    !(role === 'Master of Disguise' && (gameState.nightNumber > 1 || gameState.masterOfDisguiseTransformed))) {
                    
                    const playerGrid = document.createElement('div');
                    playerGrid.className = 'night-player-grid';
                    
                    // Determine targets based on role
                    let targets = gameState.players.filter(p => p !== player);
                    if (role === 'Doctor' && gameState.doctorSelfSaveUsed) {
                        targets = targets.filter(p => p !== alivePlayersWithRole[0]);
                    }
                    
                    targets.forEach(target => {
                        const targetDiv = document.createElement('div');
                        targetDiv.className = 'night-player-item';
                        targetDiv.dataset.player = target;
                        targetDiv.dataset.role = role;
                        
                        if (gameState.eliminated.includes(target)) {
                            targetDiv.classList.add('eliminated');
                        } else {
                            targetDiv.onclick = () => selectNightTarget(role, target);
                        }
                        
                        const targetRole = gameState.assignments[target] || 'Unknown';
                        targetDiv.innerHTML = `
                            <strong>${target}</strong><br>
                            <span style="color: #95a5a6; font-size: 12px;">${targetRole}</span>
                        `;
                        
                        playerGrid.appendChild(targetDiv);
                    });
                    
                    content.appendChild(playerGrid);
                }
            } else {
                // Role has no alive players
                const eliminatedPlayersWithRole = allPlayersWithRole.filter(p => gameState.eliminated.includes(p));
                if (eliminatedPlayersWithRole.length > 0) {
                    eliminatedPlayersWithRole.forEach(player => {
                        content.innerHTML += `<div class="eliminated-display">${player} - Eliminated</div>`;
                    });
                } else if (role === 'Master of Disguise' && (gameState.nightNumber > 1 || gameState.masterOfDisguiseTransformed)) {
                    content.innerHTML += `<div class="eliminated-display">No longer active</div>`;
                }
            }
            
            contentContainer.appendChild(content);
        }

        function createMafiaTabContent(mafiaMembers, allRoles, aliveRoles) {
            const contentContainer = document.getElementById('nightTabsContent');
            const content = document.createElement('div');
            content.className = 'night-tab-content';
            content.id = 'tab-Mafia';
            
            content.innerHTML = '<div class="night-role-display">Mafia</div>';
            
            // Show all mafia members - alive normally, eliminated with strike-through
            const allMafiaRoles = ['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'];
            allMafiaRoles.forEach(role => {
                if (gameState.assignments && Object.values(gameState.assignments).includes(role)) {
                    const playersWithRole = gameState.players.filter(p => gameState.assignments[p] === role);
                    playersWithRole.forEach(member => {
                        let memberDisplay = member;
                        let isEliminated = gameState.eliminated.includes(member);
                        
                        if (gameState.modTransformation && 
                            gameState.modTransformation.role === role &&
                            gameState.modTransformation.newPlayer === member) {
                            memberDisplay = `
                                <span style="text-decoration: line-through; color: #999;">${gameState.modTransformation.originalPlayer}</span><br>
                                <span style="color: #87ceeb; font-weight: bold;">${member}</span>
                            `;
                        } else if (isEliminated) {
                            memberDisplay = `<span style="text-decoration: line-through; color: #ec7063;">${member}</span>`;
                        }
                        
                        content.innerHTML += `<div class="player-name-display">${memberDisplay}</div>`;
                    });
                }
            });
            
            if (mafiaMembers.length > 0) {
                const executionerAlive = aliveRoles['Executioner - Mafia'] && aliveRoles['Executioner - Mafia'].length > 0;
                
                // Check if Executioner is the only mafia member alive
                const aliveMafiaRoles = [];
                if (aliveRoles['Godfather - Mafia']) aliveMafiaRoles.push(...aliveRoles['Godfather - Mafia']);
                if (aliveRoles['Executioner - Mafia']) aliveMafiaRoles.push(...aliveRoles['Executioner - Mafia']);
                if (aliveRoles['Regular Mafia']) aliveMafiaRoles.push(...aliveRoles['Regular Mafia']);
                
                const onlyExecutionerAlive = executionerAlive && aliveMafiaRoles.length === 1 && 
                                            aliveRoles['Executioner - Mafia'].length === 1;
                
                // Method selection buttons
                const methodDiv = document.createElement('div');
                methodDiv.className = 'method-buttons';
                
                // Auto-select execution if shot is disabled
                const shotSelected = onlyExecutionerAlive ? '' : 'selected';
                const executionSelected = onlyExecutionerAlive ? 'selected' : '';
                
                // Set the global variable to match the default selection
                if (onlyExecutionerAlive) {
                    selectedMafiaMethod = 'execution';
                } else {
                    selectedMafiaMethod = 'shot';
                }
                
                methodDiv.innerHTML = `
                    <button class="method-button ${shotSelected}" id="shotButton" onclick="selectMafiaMethod('shot')" ${onlyExecutionerAlive ? 'disabled' : ''}>Shot</button>
                    <button class="method-button ${executionSelected}${!executionerAlive ? ' disabled' : ''}" id="executionButton" onclick="selectMafiaMethod('execution')" ${!executionerAlive ? 'disabled' : ''}>Execution</button>
                `;
                content.appendChild(methodDiv);
                
                // Show certainty buttons if execution is auto-selected
                if (onlyExecutionerAlive) {
                    // We'll need to show the certainty buttons after adding them to the DOM
                    setTimeout(() => {
                        const certaintyButtons = document.getElementById('certaintyButtons');
                        if (certaintyButtons) {
                            certaintyButtons.style.display = 'flex';
                        }
                    }, 10);
                }
                
                // Certainty buttons (hidden by default)
                const certaintyDiv = document.createElement('div');
                certaintyDiv.className = 'certainty-buttons';
                certaintyDiv.id = 'certaintyButtons';
                certaintyDiv.innerHTML = `
                    <button class="certainty-button" id="trueButton" onclick="selectExecutionCertainty('true')">True</button>
                    <button class="certainty-button" id="falseButton" onclick="selectExecutionCertainty('false')">False</button>
                `;
                content.appendChild(certaintyDiv);
                
                // Create player grid for targets (only show alive players)
                const playerGrid = document.createElement('div');
                playerGrid.className = 'night-player-grid';
                
                const nonMafiaPlayers = gameState.players.filter(p => 
                    !mafiaMembers.includes(p) && !gameState.eliminated.includes(p)
                );
                
                nonMafiaPlayers.forEach(target => {
                    const targetDiv = document.createElement('div');
                    targetDiv.className = 'night-player-item';
                    targetDiv.dataset.player = target;
                    targetDiv.dataset.role = 'Mafia';
                    
                    targetDiv.onclick = () => selectNightTarget('Mafia', target);
                    
                    const targetRole = gameState.assignments[target] || 'Unknown';
                    targetDiv.innerHTML = `
                        <strong>${target}</strong><br>
                        <span style="color: #95a5a6; font-size: 12px;">${targetRole}</span>
                    `;
                    
                    playerGrid.appendChild(targetDiv);
                });
                
                content.appendChild(playerGrid);
            } else {
                content.innerHTML += `<div class="eliminated-display">All mafia members eliminated</div>`;
            }
            
            contentContainer.appendChild(content);
        }

        function switchNightTab(roleName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.night-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.night-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to selected tab and content
            const selectedTab = document.querySelector(`[data-role="${roleName}"]`);
            const selectedContent = document.getElementById(`tab-${roleName}`);
            
            if (selectedTab && selectedContent) {
                selectedTab.classList.add('active');
                selectedContent.classList.add('active');
            }
        }

        // Show first tab content by default
        function showFirstTab() {
            const firstTab = document.querySelector('.night-tab');
            const firstContent = document.querySelector('.night-tab-content');
            
            if (firstTab && firstContent) {
                firstTab.classList.add('active');
                firstContent.classList.add('active');
            }
        }

        function selectNightTarget(role, target) {
            // Clear previous selections for this role
            document.querySelectorAll(`[data-role="${role}"]`).forEach(item => {
                if (item.classList.contains('night-player-item')) {
                    item.classList.remove('selected');
                }
            });
            
            // Toggle selection
            const targetDiv = document.querySelector(`[data-player="${target}"][data-role="${role}"]`);
            if (targetDiv) {
                if (gameState.nightSelections[role] === target) {
                    // Deselect
                    gameState.nightSelections[role] = null;
                    targetDiv.classList.remove('selected');
                } else {
                    // Select
                    gameState.nightSelections[role] = target;
                    targetDiv.classList.add('selected');
                }
            }
        }

        // Global variables to track mafia selections
        let selectedMafiaMethod = 'shot';
        let selectedExecutionCertainty = null;

        function selectMafiaMethod(method) {
            selectedMafiaMethod = method;
            
            // Update button states
            document.getElementById('shotButton').classList.remove('selected');
            document.getElementById('executionButton').classList.remove('selected');
            document.getElementById(method + 'Button').classList.add('selected');
            
            // Show/hide certainty buttons
            const certaintyButtons = document.getElementById('certaintyButtons');
            if (method === 'execution') {
                certaintyButtons.style.display = 'flex';
            } else {
                certaintyButtons.style.display = 'none';
                selectedExecutionCertainty = null;
                // Reset certainty button states
                document.getElementById('trueButton').classList.remove('selected');
                document.getElementById('falseButton').classList.remove('selected');
            }
        }

        function selectExecutionCertainty(certainty) {
            selectedExecutionCertainty = certainty;
            
            // Update button states
            document.getElementById('trueButton').classList.remove('selected');
            document.getElementById('falseButton').classList.remove('selected');
            document.getElementById(certainty + 'Button').classList.add('selected');
        }

        function processNight() {
            const nightResults = [];
            const alivePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));
            const eliminatedThisNight = [];
            
            gameState.savedThisNight = [];
            
            // Process Master of Disguise selection (first night only)
            if (gameState.nightNumber === 1 && gameState.nightSelections['Master of Disguise']) {
                gameState.masterOfDisguiseSelection = gameState.nightSelections['Master of Disguise'];
                nightResults.push(`Master of Disguise selected ${gameState.nightSelections['Master of Disguise']}.`);
            }
            
            // Process Jailer
            if (gameState.nightSelections['Jailer'] && gameState.jailerUsesLeft > 0) {
                const jailedPlayer = gameState.nightSelections['Jailer'];
                gameState.jailerUsesLeft--;
                nightResults.push(`Jailer jailed ${jailedPlayer} for the night.`);
            }
            
            // Process Doctor - Process first to determine who gets saved
            if (gameState.nightSelections['Doctor']) {
                const target = gameState.nightSelections['Doctor'];
                gameState.savedThisNight.push(target);
                
                const doctorPlayer = alivePlayers.find(p => gameState.assignments[p] === 'Doctor');
                if (target === doctorPlayer) {
                    gameState.doctorSelfSaveUsed = true;
                }
                nightResults.push(`Doctor saved ${target}.`);
            }
            
            // Process Mafia
            if (gameState.nightSelections['Mafia']) {
                const target = gameState.nightSelections['Mafia'];
                const method = selectedMafiaMethod;
                
                let mafiaSuccess = false;
                
                if (method === 'execution') {
                    const certainty = selectedExecutionCertainty;
                    if (certainty === 'true') {
                        mafiaSuccess = true;
                        nightResults.push(`Mafia executed ${target} successfully.`);
                    } else if (certainty === 'false') {
                        nightResults.push(`Mafia execution of ${target} failed.`);
                    }
                } else {
                    const targetRole = gameState.assignments[target];
                    
                    if (targetRole === 'Godfather - Mafia' && gameState.godfatherShieldActive) {
                        gameState.godfatherShieldActive = false;
                        if (!gameState.savedThisNight.includes(target)) {
                            mafiaSuccess = true;
                            nightResults.push(`Mafia shot ${target}. Godfather's shield is broken and they are eliminated.`);
                        } else {
                            nightResults.push(`Mafia shot ${target}. Godfather's shield is broken but they were saved by Doctor.`);
                        }
                    } else if (targetRole === 'Shooter' && gameState.shooterShieldActive) {
                        gameState.shooterShieldActive = false;
                        nightResults.push(`Mafia shot ${target}. Shooter's shield absorbed the attack.`);
                    } else {
                        if (!gameState.savedThisNight.includes(target)) {
                            mafiaSuccess = true;
                            nightResults.push(`Mafia shot ${target} successfully.`);
                        } else {
                            nightResults.push(`Mafia shot ${target}, but they were saved by Doctor.`);
                        }
                    }
                }
                
                if (mafiaSuccess && !gameState.savedThisNight.includes(target)) {
                    eliminatedThisNight.push(target);
                }
            }
            
            // Process Shooter
            if (gameState.nightSelections['Shooter'] && gameState.shooterUsesLeft > 0) {
                const target = gameState.nightSelections['Shooter'];
                const targetRole = gameState.assignments[target];
                gameState.shooterUsesLeft--;
                
                const isMafia = ['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'].includes(targetRole);
                
                if (!isMafia) {
                    const shooterPlayer = alivePlayers.find(p => gameState.assignments[p] === 'Shooter');
                    if (shooterPlayer && !eliminatedThisNight.includes(shooterPlayer)) {
                        eliminatedThisNight.push(shooterPlayer);
                        nightResults.push(`Shooter shot non-mafia ${target} and is eliminated as penalty.`);
                    }
                } else {
                    if (!gameState.savedThisNight.includes(target)) {
                        eliminatedThisNight.push(target);
                        nightResults.push(`Shooter shot mafia ${target} successfully.`);
                    } else {
                        nightResults.push(`Shooter shot mafia ${target}, but they were saved by Doctor.`);
                    }
                }
            }
            
            // Process other roles
            if (gameState.nightSelections['Detective']) {
                nightResults.push(`Detective investigated ${gameState.nightSelections['Detective']}.`);
            }
            
            if (gameState.nightSelections['Devotee']) {
                const target = gameState.nightSelections['Devotee'];
                const targetRole = gameState.assignments[target];
                
                const isMafia = ['Godfather - Mafia', 'Executioner - Mafia', 'Regular Mafia'].includes(targetRole);
                if (isMafia) {
                    const devoteePlayer = alivePlayers.find(p => gameState.assignments[p] === 'Devotee');
                    if (devoteePlayer && !eliminatedThisNight.includes(devoteePlayer)) {
                        eliminatedThisNight.push(devoteePlayer);
                        nightResults.push(`Devotee woke up ${target} who is mafia. Devotee is eliminated.`);
                    }
                } else {
                    nightResults.push(`Devotee woke up ${target} who is not mafia. Nothing happens.`);
                }
            }
            
            if (gameState.nightSelections['Psychiatrist']) {
                nightResults.push(`Psychiatrist treated ${gameState.nightSelections['Psychiatrist']}.`);
            }
            
            // Add eliminated players to the main eliminated list
            eliminatedThisNight.forEach(player => {
                if (!gameState.eliminated.includes(player)) {
                    gameState.eliminated.push(player);
                }
            });
            
            // Reset locked player and night selections
            gameState.lockedPlayer = null;
            gameState.nightSelections = {};
            
            // Reset mafia method selections
            selectedMafiaMethod = 'shot';
            selectedExecutionCertainty = null;
            
            // Store night results and go to summary
            gameState.nightResults = nightResults;
            gameState.eliminatedThisNight = eliminatedThisNight;
            
            showNightSummary();
        }

        function showNightSummary() {
            document.getElementById('summaryTitle').textContent = `Night ${gameState.nightNumber} Summary`;
            
            const resultsContainer = document.getElementById('nightResults');
            
            if (gameState.eliminatedThisNight && gameState.eliminatedThisNight.length > 0) {
                const eliminatedNames = gameState.eliminatedThisNight.join(' and ');
                resultsContainer.innerHTML = `<h2>${eliminatedNames} ${gameState.eliminatedThisNight.length === 1 ? 'has' : 'have'} been eliminated.</h2>`;
            } else {
                resultsContainer.innerHTML = '<h2>Nothing happened last night.</h2>';
            }
            
            gameState.nightNumber++;
            goToPage(6);
        }

        function revealEliminationCount() {
            const button = document.getElementById('revealBtn');
            const summary = document.getElementById('eliminationSummary');
            
            if (gameState.eliminationCountRevealsLeft > 0 && !gameState.eliminationCountRevealed) {
                gameState.eliminationCountRevealsLeft--;
                gameState.eliminationCountRevealed = true;
                
                const eliminatedRoles = {};
                gameState.eliminated.forEach(player => {
                    const role = gameState.assignments[player];
                    if (!eliminatedRoles[role]) eliminatedRoles[role] = 0;
                    eliminatedRoles[role]++;
                });
                
                const eliminatedMafia = (eliminatedRoles['Godfather - Mafia'] || 0) + 
                                       (eliminatedRoles['Executioner - Mafia'] || 0) + 
                                       (eliminatedRoles['Regular Mafia'] || 0);
                
                const eliminatedNonMafia = gameState.eliminated.length - eliminatedMafia;
                
                summary.innerHTML = `
                    <h3>Elimination Count Revealed</h3>
                    <p><strong>Mafia Eliminated:</strong> ${eliminatedMafia}</p>
                    <p><strong>Non-Mafia Eliminated:</strong> ${eliminatedNonMafia}</p>
                    <p><strong>Reveals Left:</strong> ${gameState.eliminationCountRevealsLeft}</p>
                `;
                summary.style.display = 'block';
                button.textContent = 'Hide Elimination Count';
            } else if (gameState.eliminationCountRevealed) {
                gameState.eliminationCountRevealed = false;
                summary.style.display = 'none';
                button.textContent = 'Reveal Elimination Count';
            } else {
                alert('No more reveals left!');
            }
        }

        function goToNextDay() {
            gameState.dayNumber++;
            document.getElementById('dayTitle').textContent = `Day ${gameState.dayNumber} - Elimination`;
            
            gameState.selectedForElimination = null;
            document.getElementById('dayEliminatedRole').innerHTML = '';
            
            // Reset bullet selection for Day 1
            gameState.selectedBullet = null;
            document.getElementById('bullet1Button').classList.remove('selected');
            document.getElementById('bullet2Button').classList.remove('selected');
            
            const dropdowns = ['lockAbilitySelect', 'additionalEliminationSelect', 'roleSwapSelect'];
            dropdowns.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            
            const resultDivs = ['lockedPlayer', 'additionalEliminatedPlayer', 'roleSwapResult'];
            resultDivs.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
            
            setupDayElimination();
            goToPage(4);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded, initializing...");
            initializeRoleSelection();
            updateGameStatsHeader();
            
            // Show first tab content by default when on night page
            setTimeout(() => {
                if (gameState.currentPage === 5) {
                    showFirstTab();
                }
            }, 100);
        });

        // Backup initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeRoleSelection);
        } else {
            initializeRoleSelection();
            updateGameStatsHeader();
        }
    </script>
</body>
</html>
